# entities/template/modus_urlaub.yaml

- sensor:
    - name: "Modus Urlaub Home"
      unique_id: modus_urlaub_home
      icon: mdi:home
      # device_class: occupancy
      state: >
        {% set locations = ['Zuhause', 'Zu Hause', 'sinena', ''] %}
        {% set keywords = ['Urlaub', 'Holiday'] %}
        {% set message_steffi = state_attr('calendar.steffi', 'message') or '' %}
        {% set location_steffi = state_attr('calendar.steffi', 'location') or '' %}
        {% set message_jan = state_attr('calendar.jan', 'message') or '' %}
        {% set location_jan = state_attr('calendar.jan', 'location') or '' %}

        {% set steffi_match = keywords | select('lower') | select('in', message_steffi.lower()) | list %}
        {% set jan_match = keywords | select('lower') | select('in', message_jan.lower()) | list %}

        {% set steffi_home = steffi_match | length > 0 and location_steffi in locations %}
        {% set jan_home = jan_match | length > 0 and location_jan in locations %}

        {{ steffi_home or jan_home }}

- sensor:
    - name: "Modus Urlaub Away"
      unique_id: modus_urlaub_away
      icon: mdi:island
      # device_class: occupancy
      state: >
        {% set locations = ['Zuhause', 'Zu Hause', 'sinena', ''] %}
        {% set keywords = ['Urlaub', 'Holiday'] %}
        {% set message_steffi = state_attr('calendar.steffi', 'message') or '' %}
        {% set location_steffi = state_attr('calendar.steffi', 'location') or '' %}
        {% set message_jan = state_attr('calendar.jan', 'message') or '' %}
        {% set location_jan = state_attr('calendar.jan', 'location') or '' %}

        {% set steffi_match = keywords | select('lower') | select('in', message_steffi.lower()) | list %}
        {% set jan_match = keywords | select('lower') | select('in', message_jan.lower()) | list %}

        {% set steffi_away = steffi_match | length > 0 and location_steffi not in locations %}
        {% set jan_away = jan_match | length > 0 and location_jan not in locations %}

        {{ steffi_away or jan_away }}
